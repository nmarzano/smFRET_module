[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.10989968.svg)](https://doi.org/10.5281/zenodo.10989969)

# Two- and Three-Colour Single-Molecule FRET Trace Analaysis

General purpose repository for the analysis of two- and three-colour single-molecule FRET data, generated by Dr Nicholas Marzano. This repository has predominanly been used to investigate how molecular chaperone proteins affect the conformation of their clients during productive folding and for interrogating how RNA-binding proteins bind to specific RNA sequences; however, this is a very general workflow that performs many different kinds of analysis that could be of use to any biological system.

Generally, the code imports the raw FRET data, removes outliers and analyses the kinetic details originating from Hidden Markov Model (HMM) fitting of the data using the vbFRET MATLAB program. Furthermore, the data can be analysed and processed to extract useful kinetic information (e.g., residence time of states, determining the occurence and rates of specific FRET transitions, analysis of live-flow data) and then plotted in simple and effective plots for visualization (e.g., FRET histograms, transition density plots [TDPs], FRET-intensity traces, cumulative residence time analysis) for easy data visualization.

Recently, the code has been expanded to simulate kinetic simulations of molecular chaperone binding to client proteins, which can be used to generate synthetic data that can be used to test a variety of parameters (e.g., on/off rates, number of chaperone binding sites, etc.) to predict experimental smFRET data.  

# Installation
This module is a work in progress, designed to capture common functionality which recurs in analysis of single-molecule FRET data. It primarily contains the `src` folder, which contains general purpose functions. For best use, clone https://github.com/nmarzano/smFRET-experiment-template repository, which contains a set of analysis scripts that use this module.

To install this module as a git submodule within your own smFRET-experiment-template repository, use the following command:
```
git submodule add https://github.com/nmarzano/smFRET_module smfret
```

Installation should occur immediately. 

## Data requirements

Data required for analysis using these scripts are as follows:
**(2-colour analysis)**
The idealized FRET data for individual molecules following HMM analysis using vbFRET. These are generated following fitting and saving the data as ‘Idealized Traces’ with ‘Individual Text Files’ (in .dat format). Data for individual molecules is exported from vbFRET and stored within a folder. 
    
**(3-colour experiments)**
Data required is exported as .txt files from the MASH-FRET GUI program (v 1.2.2). 

## General usage notes/Demo

For best use, this module can be combined with a general purpose experiment template that can be found here (https://github.com/nmarzano/smFRET-experiment-template). Here, the scripts are seperated into those used for two-colour and three-colour FRET, where each script within these folders should be run in order to ensure any source data is generated as needed (although in some cases this is not essential). 

The analysis scripts are seperated to do the following functions:

**(0-import_data)**
Will import raw data from a list of directories that has been copied into the raw_data.txt file (located in the raw_data folder). The directories provided should be links to a folder that contains a .dat file for each molecule to be analysed within that treatment, generated by saving as 'idealized traces' and 'individual molecules' from vbFRET.

Alternatively, folders containing .dat files exported from vbFRET can be collated into a csv file template (provided in smFRET-experiment-template repository) and imported using the second option within (0-import_data). This is particularly useful when dealing with a large number of treatments, where each treatment folder contains many .dat files. This is essential if you wish to observe the variance in FRET behaviour between different experimental replicates.
    
**(1-histogram_timelapse_traces_synchtrans_heatmap)**
Run each function within this script in the order that they are provided to ensure that all data is generated as needed.
Will do several functions, not all of which are essential to do. The first is essential, whereby all the directories provided in (0-import_data) are concatenated into a single dataframe for downstream processing. From here, outliers are excluded and histograms, traces, synchronised transitions and gaussian fits of the histograms can be plotted. Some of the functions called will rely on additional data input (e.g., liveflow and heatmap data), since these do not rely on the concatenated dataframe, meaning specific datasets must be provided within the appropiate dictionaries. 

**(2-transition-and-residence-time-analysis)**
Run each function within this script in the order that they are provided to ensure that all data is generated as needed.

These scripts are primarily for the analysis of kinetic information derived from the HMM fits of each trace. From these analyses, the visualization of transitions within a dataset can be performed (as transition density plots [TDPs]) or interrogations of certain transitions of interest, easily accessed by user FRET thresholding, to determine rates of FRET transitions, residence times of certain states and the occurence of certain transitions.
 
**(3-three-colour-smFRET-import)**
Will import raw data from a list of directories that has been copied into the rscript. The directories provided should be links to a folder that contains a .txt file for each molecule to be analysed within that treatment, generated by exporting ASCII from the MASH-FRET GUI program (v 1.2.2).

**(4-three-colour-smFRET-analysis)**
Will take the raw data from multiple treatments and concatenate into a single dataframe. From here, the traces will be fit to a HMM model, which requires importing the 'deepfret_nm' module (https://github.com/nmarzano/deepfret_nm, forked from the hatzakis lab), and then the fitted traces can be plotted, the FRET calculated (plotted as histograms) and the synchronised transitions determined and visualized (allowing the analysis of certain FRET transitions and observation of a third fluorophore).
    
**(Hsp70 modelling)**
This script is used to simulate kinetic models of Hsp70 binding to client protein by providing a simple set of parameters, which can likely be determined experimentally (i.e., kon, koff and number of binding sites). Transitions between different chaperone-bound states are then simulated, used to generate theoretical FRET trajectories that allow kinetic details (e.g., dwell/residence times, occurence of transitions of interest, etc) to be predicted. This provides a useful avenue by which experimental smFRET data can be compared to simulations, which informs on biological mechanisms. 

Note on run times: Individual functions within the scripts should run in a matter of minutes, although this will depend on the number of molecules being analysed. The most time-consuming step is fitting three-colour data to a HMM model using the deepfret_nm module, which can take up to an hour depending on the number of molecules being analysed.

Note on expected output: Each script will generate a series of figures that are saved within the relevant treatment folder (e.g., histograms, FRET traces, TDPs, etc). In addition, processed data files are also saved as .csv files for downstream analysis. 

### Data source

To generate data used for analysis using these scripts, all that is required is a single movie where there is direct excitation of the donor fluorophore (for two-colour experiments) or alternate excitation of the two donor fluorophores (for three-colour experiments, e.g., excitation of AF488 dye, then excitation of AF555 dye that can FRET to AF647 dye). The exported images can then be directly imported and processed into the MASH-FRET GUI program (v 1.2.2) for intitial molecule selection and processing. 

## Example data 

Example data used in the generation of figures can be found here: https://zenodo.org/records/17118152. Individual compressed folders contain raw data for different experiments, which are found within folders (containing .dat files). These can be be directly imported into the analysis scripts provided in the smFRET-experiment-template repository - further instructions for the compilation of experiment replicates can also be found within the associated smFRET-experiment-template repository.

## System requirements

- All software dependencies and operating systems (including version numbers) are listed in the standard_environment.yml file (for 2-colour analysis) and threecolour_environment.yml file (for 3-colour analysis)
- This code has been tested on Windows 10 operating system, using the above mentioned python environments (containing all required packages and versions).
- This code does not require any non-standard hardware
